# What are statistical models? {#sec-stats-modeling}

When working with data in research, it is almost impossible to avoid
needing to do some form of statistical analysis. Running statistical
analyses is usually methodical and well-defined, though it often
involves some trial and error. However, there's still a general
structure and pattern to doing statistical analyses that we can learn
and apply to many different types of analyses.

For this session, we are going to cover some basics of what statistical
models are, what the general workflow is for using them in research, and
how we can use this knowledge to help us with coding in R. This session
is a no-code session, as we need to first understand this part before we
can code anything for an analysis.

## Learning objectives

{{< include /includes/objectives/_stats-modeling.qmd >}}

Things that we will *not* cover:

-   How to choose and apply the appropriate statistical model or tests.
-   More detailed statistical theory.
-   How to determine relevant data transformations for statistical
    tests.
-   How to interpret the statistical results.

## :speech_balloon: Discussion activity: What does a "model" mean?

**Time: \~6 minutes.**

In science and especially statistics, we talk a lot about "models". But
what does model actually mean? What different types of definitions can
you think of? Is there a different understanding of model in statistics
compared to other areas?

1.  Take 1 minute to think about your understanding of a model.
2.  Then, over the next 3 minutes, discuss with your neighbour about the
    meaning of "model" and see if you can come to a shared
    understanding.
3.  Finally, over the next 2 minutes, we will share all together what a
    model is in the context of data analysis.

**Don't look ahead!** :wink:

## :book: Reading task: A brief introduction to mathematical models

**Time: \~6 minutes.**

::: {.callout-note collapse="true"}
## :teacher: Instructor note

After they've read it over, reinforce that a model is a mathematical
representation of the research question. Emphasize that we need a model
in order to answer the research question using data.
:::

Research, especially quantitative research, is about making inferences
about the world by quantifying uncertainty from some data. And we
quantify uncertainty by using statistics and statistical models.

A statistical model is a simple way to describe the real world using
mathematics. In research, we often aim to understand the relationships
between multiple variables. For example, if we change the predictor
(independent variable or $x$), how does that affect the outcome
(dependent variable or $y$)?

Some simple examples are:

-   "How does this new cancer treatment affect survival rates?"
-   "How does this new user interface affect user watch time?"

or more complex:

-   "How does sunlight and water affect plant growth?"
-   "What is the relationship between a metabolite and type 1 diabetes
    compared to controls, adjusting for age and gender?"

These relationships can involve single or multiple predictors (such as
sunlight and water, or metabolite, gender, and age). The outcomes can be
either continuous (such as plant growth) or categorical (such as whether
a person has type 1 diabetes or not).

The relationship between predictors and the outcome is known as a
regression, or rather a *regression function*. So if there is a
relationship between $x$ and $y$, the math formula is:

$$y = f(x)$$

So for any given value of $x$, the function $f(x)$ will give us the
expected value of $y$. For example, we might expect a relationship
between plant growth, water, and sunlight. We could model plant growth
as depending on water and sunlight. Graphically, we can illustrate this
model as:

```{mermaid fig-model-plant-growth}
%%| fig-cap: Simple example of a theoretical model of plant growth.
%%| echo: false
%%| eval: true
graph LR
    Sunlight --> Growth
    Water --> Growth
    Sunlight --- Water
```

or mathematically:

$$growth = f(sunlight + water)$$

This math formula is our theoretical model that represents our research
question. However, not all theoretical models can be tested against the
real world. We need to use parameters (like sunlight) in our theoretical
model that can actually be measured. In this case, we need to measure
plant growth (e.g., weight in grams), the amount of water given per day
(in liters), and the number of sunlight hours per day.

Without this mathematical model, you cannot adequately answer your
research, at least not quantitatively nor scientifically.

{{< text_snippet sticky_up >}}

## :book: Reading task: All statistics are basically a version of regression

**Time: \~8 minutes.**

::: {.callout-note collapse="true"}
## :teacher: Instructor note

Reinforce the model as a formula, that all models are basically a linear
regression, that the model tells us some information about the
assumptions of the data, and that we can use this knowledge to help us
write more effective code.
:::

The above theoretical, mathematical model is great to conceptually
understand and design your research question, especially in how to
answer your research question. However, to actually use this model with
data to get some form of an answer to our question, we need to modify
it. That's where statistical models come in, and in particular,
regression models.

A regression model describes the relationship between an outcome ($y$)
and one or more the predictor(s) ($x$) in a way that also accounts for
uncertainty. That's because no relationship between variables is
perfect. So first thing that a regression model has is a mathematical
variable called random error ($error$ or $residuals$) to quantify the
difference between the function $f()$ and the predictors:

$$y = f(x) + error$$

Usually, the function $f()$ in a regression model is fully expressed as
a formula:

$$y = intercept + estimate \times x + error$$

Here, the $intercept$ is the value of $y$ when $x$ is zero and
$estimate$ (also known as $beta$) is the value that describes how much
$y$ changes for each unit increase in $x$ (the "slope" of the
relationship). What our research question and what our outcome is
determines what type of regression model the formula is (e.g. linear or
logistic regression).

If we convert our plant growth example into this formula, it would look
like:

$$growth = intercept + estimate1 \times sunlight + estimate2 \times water + error$$

Because growth is a continuous variable (plants can grow by any amount),
this is a linear regression model. If the outcome was binary (e.g.,
whether a plant survived or not), it would be a logistic regression
model. In fact, almost all statistical methods are basically modified
forms of a regression model. These methods range from things as complex
as AI models like large language models to things as simple as t-tests
or ANOVAs.

With this model, we can apply it to our data to estimate the impact that
sunlight and water have on plant growth. Importantly, we can get the
estimates and the uncertainty of those estimates to give us a
quantitative answer to our research question: How *much* sunlight
exactly and how *much* water exactly do plants need to grow? How
*exactly* uncertain are we about those estimates?

With this formula, we can already get some insights about the
assumptions that the model has for the data that it will fit:

1.  The formula is used to estimate *one individual plant's growth*.
    Meaning, our data needs to be at an individual plant level. So each
    value of each variable in our data (each row) needs to represent one
    plant.

2.  The variables are assumed to have a linear relationship with the
    outcome: one unit increase in sunlight and one unit increase in
    water lead to a specific and consistent increase in growth. If this
    isn't true, we might need to transform the data before hand or not
    use one of variables.

3.  The variables can't have any strong dependency between each other.
    For example, if sunlight increases and that causes water to
    decrease, the estimates won't be reliable since we won't be able to
    put any value we want in the formula for both sunlight and water
    independently. Which means we have to be careful which variables we
    include in the model.

4.  If we want to compare estimate, e.g. between sunlight and water, the
    variables need to be on the same scale since the estimates are based
    on the unit of the variable. We would need to transform the data
    before fitting the model if we want to compare estimates.

As you may notice, by knowing the math behind the statistical methods,
it will help you structure and process your data to more accurately fit
the model you want to the data you have. It can also help in how to
write your code to more effectively run these analyses. How?

-   By treating this model formula as an R object, that we can
    manipulate, modify, and process with code just as we do with data.

-   By using design thinking to conceptually break down the model
    fitting process into specific steps, which we can translate into R
    functions. That we can then chain together and put into a
    reproducible pipeline.

-   By identifying how our R data frame should look like before it gets
    fit to the model.

{{< text_snippet sticky_up >}}

## :book: Reading task: The workflow of statistical modeling

**Time: \~6 minutes.**

::: {.callout-note collapse="true"}
## :teacher: Instructor note

A few things to repeat and reinforce:

1.  The workflow of the image and that it all starts with the research
    question.
2.  That this model creation stage requires a variety of domain
    expertise, not just statistical expertise.
:::

As mentioned above, while there are many different types of statistical
models that each require the data is structured in specific ways,
there is a common workflow that applies to all statistical analyses.

This generic workflow for going from research
question to getting results that we can apply to many types of analyses,
leading to a common "pattern" for writing code. This workflow generally
involves the following steps:

1.  **Write a research question** that fits a theoretical model with
    measurable parameters.

2.  **Select the best model type** based on the model parameters (e.g.,
    linear regression, logistic regression, ANOVA, or t-test).

3.  **Collect or select the right data for your model parameters**
    (e.g., water in liters per day, plant growth in weight, sunlight in
    hours per day). Collect data if you don't have any or select from
    existing data.

4.  **Fit the data to the model** to estimate the values (coefficients)
    of the model, such as the intercept, slope, and uncertainty (error).

5.  **Extract and present the values** in relation to your research
    questions.

```{mermaid fig-model-building-workflow}
%%| fig-cap: Simple schematic of the process for conducting statistical analysis.
%%| echo: false
%%| eval: true
graph TD
    A[Research question] --> B[Theoretical model]
    B --> A
    B --> C[Data collection<br>or selection]
    C --> D[Data transformation]
    D --> F[Fit model<br>to data]
    B --> F
    F --> E[Scientific results]
    E --> A
```

::: {.callout-caution appearance="default"}
Connecting the correct statistical model to the data and research
question requires highly specific domain knowledge in multiple areas.
For instance, to effectively analyze our `lipidomics` dataset, we would
need experts who are familiar with, e.g. how -omic data are measured,
how to transform them, which modeling methods to use, and how to
interpret the results. We have **none** of these things and are likely
doing things incorrectly. But this is a workshop on coding and
reproducible, so statistical correctness isn't our focus.
:::

{{< text_snippet sticky_up >}}

## :speech_balloon: Discussion activity: Defining a model for our lipidomics data

**Time: \~15 minutes.**

::: {.callout-note collapse="true"}
## :teacher: Instructor note
:::

```{r admin-show-data}
#| echo: false
readr::read_csv(here::here("data/lipidomics.csv"),
  show_col_types = FALSE
)
```


How to make the results between metabolites comparable.


Going back to our own lipidomics dataset, we need to do the first step:
Creating the question. While we don't have much data, there are a
surprising number of questions we could ask. But we will keep it very
simple, very basic, and very exploratory.

1.  What is the estimated relationship of each metabolite with type 1
    diabetes (T1D) compared to the controls?

2.  What is the estimated relationship after considering the influence
    of age and gender?

A graphical representation of this theoretical model could be:

```{mermaid fig-model-research-question}
%%| fig-cap: A simple theoretical model of the research question about T1D status.
%%| echo: false
%%| eval: true
graph LR
    Metabolite --> T1D
```

```{mermaid fig-model-research-question}
%%| fig-cap: A simple theoretical model of the research question about T1D status.
%%| echo: false
%%| eval: true
graph TB
    Metabolite --> T1D
    Age & Gender --> T1D & Metabolite
```

Or mathematically:

$$T1D = metabolite$$

$$T1D = metabolite + age + gender$$

So, T1D status (or `class` in the `lipidomics` dataset) is our
**outcome** and the individual metabolite, age, and gender are our
**predictors**. Technically, age and gender would be "confounders" or
"covariates", since we include them only because we think they influence
the relationship between the metabolite and T1D.

If we convert the formula into a form that uses the variable names that
we have in the dataset, it would look like:

$$class = metabolite$$

$$class = metabolite + age + gender$$

```{mermaid}
flowchart TB
    q[Question] -->|?| result[Result]
```

```{mermaid}
flowchart TB
    q[Question] -->|?| stats[Statistics]
    stats -->|?| result[Result]
```

```{mermaid}
flowchart TB
    q[Question] -->|?| model[Statistical<br>model]
    model & data[Data] -->|?| result[Result]
```

```{mermaid}
flowchart TB
    q[Question] --> model[Model]
    model & data[Data] -->|?| rs[Results]
```

Now that we have a theoretical model, we need to choose our model type.
Since T1D is binary (either you have it or you don't), the most likely
choice is logistic regression, which requires a binary outcome variable.
So we have the theoretical model and the type of model to use, now how
do we express this as code in R? There are many ways of doing the same
thing in R, but some are a bit easier than others.

## Summary

-   Create research questions that (ideally) are structured in a way to
    mimic how the statistical analysis will be done, preferably in a
    "formula" style like $y = x1 + x2 + ... + error$ and in a diagram
    style with links connecting variables.
-   Statistical analyses, while requiring some trial and error, are
    surprisingly structured in the workflow and steps taken. Use this
    structure to help guide you in completing tasks related to running
    analyses.
